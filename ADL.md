# Architecture decision log

> формат: 
> ## ADR-000  (status) КРАТКО О ЧЕМ
> Обоснование выбора, с сылками на NFR, US, CON.\
> _пустая строка_

## ADR-000 (active) выбор архитектуры
Используем BPMN-compatible обпеньсорсный оркестратор, вызывающий отдельные действия посредством HTTP\JSON вызовов.   
Обоснование:
1. Описание содержит несколько процессов с разными участниками. Реализация логики процессов в коде потребует изменения кода каждый раз, когда потребуется поменять местами пару шагов при сохранении сути самих действий. В случае оркестратора, достаточно поменять BPMN описание.
2. Писать самому BPMN движок нет смысла, поэтому берем opensource (Camunda7, JBPM etc)
3. Сюда же - желание менеджеров скрыть детали имплементации матчинга. Камунда может показать последовательность без раскрытия деталей отдельных проверок.

## ADR-001 (active) выбор СУБД
Данные храним:
1) Постгря как штатная база камунды
2) document-oriented для информации о клиентах и продуктах
3) реляционка для финрасчетов и BI.
Обоснование:
* На текущий момент, нет никаких требований, явно ограничивающих выбор СУБД:
  * нет информации, которую стоит хранить как граф
  * нет требований, по которым стоит предпочесть именно Key-Value
* Camunda умеет работать с PostgreSQL
* В случае разделения на микросервисы, SQL Lite будет ограничивать масштабирование
* Доступность можно повысить кластеризацией
* Документ-ориентированная база позволит расширять модель данных котов, продуктов, клиентов

## ADR-002 (active) eventstorming notation  
Для записи ивент-шторминга используем BPMN.  
Обоснование:
- форма элементов (квадратики-ромбики) имеет банальное объяснение - большинство бумажных стикеров - квадратной формы. Т.е. любые фигры, понятные команде, не хуже других.
- BPMN понятен многим аналитикам и даже бизнесу без обучения (если не упарываться)
- в отличие от miro и прочих "досок", у Camunda Modeler есть симулятор, позволяющий наглядно проследить поток.

## ADR-003 Матчинг
Матчинг - нейронками.
Почему я отказался от графов в пользу нейронок - это из-за необходимости делать повторный матчинг, если первый воркер не пришел. Т.е. нужно выбрать воркера по тем же критериям, но не того же самого. И тут вероятностная природа нейронок упрощает реализацию (если самого вероятного уже нельзя - берем следующего по порядку). 
